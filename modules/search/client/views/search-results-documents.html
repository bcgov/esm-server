<div class="file-browser">

	<div class="fb-header">
		<div class="fb-breadcrumbs">
			Documents
		</div>
		<div class="file-batch-actions">
			<div class="fb-menu btn-group">
				<button type="button" class="btn icon-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ng-disabled="!vm.batchMenuEnabled">
					<span class="glyphicon glyphicon glyphicon-option-vertical"></span>
				</button>
				<ul class="dropdown-menu pull-right">
					<li>
						<a title="Rename Folder"
							ng-if="project.userCan.manageFolders"
						    ng-show="vm.checkedDirs.length === 1 && vm.checkedFiles.length === 0"
							x-document-mgr-rename-folder
							x-project="project"
							x-root="vm.rootNode"
							x-node="vm.checkedDirs[0]"><span class="glyphicon glyphicon-edit"></span> Rename</a>
					</li>
					<li>
						<a title="Delete"
						   ng-hide="vm.deleteSelected.confirmItems.length === 0"
						   x-confirm-dialog
						   x-title-text="vm.deleteSelected.titleText"
						   x-ok-text="vm.deleteSelected.okText"
						   x-cancel-text="vm.deleteSelected.cancelText"
						   x-confirm-text="vm.deleteSelected.confirmText"
						   x-confirm-items="vm.deleteSelected.confirmItems"
						   x-on-ok="vm.deleteSelected.ok"><span class="glyphicon glyphicon-trash"></span> Delete</a>
					</li>
					<li>
						<a title="Publish"
							ng-hide="vm.publishSelected.publishableFiles.length === 0"
							x-confirm-dialog
							x-title-text="'Publish File(s)'"
							x-ok-text="vm.publishSelected.okText"
							x-cancel-text="vm.publishSelected.cancelText"
							x-confirm-text="'Are you sure you want to publish the selected file(s)?'"
							x-confirm-items="vm.publishSelected.confirmItems"
							x-on-ok="vm.publishSelected.publish"><span class="glyphicon glyphicon-ok-circle"></span> Publish</a>
					</li>
					<li>
						<a title="Unpublish"
						    ng-hide="vm.publishSelected.unpublishableFiles.length === 0"
						    x-confirm-dialog
							x-title-text="'Unpublish File(s)'"
							x-ok-text="vm.publishSelected.okText"
							x-cancel-text="vm.publishSelected.cancelText"
							x-confirm-text="'Are you sure you want to unpublish the selected file(s)?'"
							x-confirm-items="vm.publishSelected.confirmItems"
							x-on-ok="vm.publishSelected.unpublish"><span class="glyphicon glyphicon-ban-circle"></span> Unpublish</a>
					</li>
					<li>
						<a title="Move Folders & Files"
						   ng-hide="vm.moveSelected.moveableFiles.length === 0 && vm.moveSelected.moveableFolders.length === 0"
						   x-document-mgr-move
						   x-title-text="vm.moveSelected.titleText"
						   x-project="project"
						   x-root="vm.rootNode"
						   x-node="vm.rootNode"
						   x-move-selected="vm.moveSelected"><span class="glyphicon glyphicon-transfer"></span> Move to...</a>
					</li>
				</ul>
			</div>
		</div>
	</div>

	<!-- Busy -->
	<div class="spinner-container" ng-show="vm.busy">
		<div class="spinner-new rotating"></div>
	</div>

	<div class="fb-body" ng-class="{'panel-open': vm.infoPanel.open}">

		<div class="table-container">

			<table class="search-table"  st-table="vm.somethingElse" st-safe-src="vm.displayResults">
				<thead>
				<tr class="sort-row">
					<th class="col checkbox-col" ng-if="vm.authentication.user">
						<input id="select-all" type="checkbox" title="Select All / None" ng-model="vm.allChecked" ng-click="vm.checkAll()"/>
						<label for="select-all"><span class="glyphicon glyphicon-ok"/></label>
					</th>
					<th class="name-col" st-sort="name">Name <span class="sort-icon"/></th>
					<th class="date-added-col" st-sort="date">Uploaded <span class="sort-icon"/></th>
					<th class="status-col" ng-if="vm.authentication.user" st-sort="pub">Status <span class="sort-icon"/></th>
					<th class="actions-col">&nbsp;</th>
				</tr>
				</thead>

				<tbody>
				<tr class="comment-row clickable"
						ng-class="{'selected': item.selected}"
						ng-repeat="item in vm.displayResults"
						ng-click="vm.selectItem(item)">
					<td class="col checkbox-col" ng-if="vm.authentication.user">
						<input id="{{item.id}}" type="checkbox" ng-model="item.selected" ng-click="vm.selectItem(item)"/>
						<label for="{{item.id}}"><span class="glyphicon glyphicon-ok"/></label>
					</td>
					<td>
						<div class="document-info">
							<div class="icon">
								<span class="avatar" ng-if="!item.isFile">
									<span class="fb-folder glyphicon glyphicon-folder-close"></span>
								</span>
								<span class="avatar"  ng-if="item.isFile">
									<span class="fb-file glyphicon glyphicon-file" ng-if="!item.isImage"></span>
									<span class="fb-img glyphicon glyphicon-picture" ng-if="item.isImage"></span>
								</span>
							</div>
							<div class="text">
								<div class="name">{{ item.displayName }}</div>
								<div class="description">{{ item.description | maxWords: 20 }}</div>
							</div>
						</div>
					</td>
					<td class="date-added-col">
						{{ item.dateUploaded | date : format : timezone }}
					</td>
					<td class="status-col" ng-if="vm.authentication.user">
						<span ng-if="item.isPublished" title="Published"><span class="glyphicon glyphicon-ok-circle"/></span>
					</td>
					<td class="actions-col row-actions">
						<div class="btn-group" ng-if="!item.isFile">
							<button class="btn icon-btn dropdown-toggle" type="button" ng-click="$event.originalEvent.dropdown = true" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon glyphicon-option-vertical"></span>
							</button>
							<ul class="dropdown-menu pull-right">
								<li ng-if="project.userCan.manageFolders">
									<button class="btn icon-btn" title="Edit Folder Details" ng-click="$event.stopPropagation();"
													x-document-mgr-rename-folder
													x-project="project"
													x-root="documentMgr.rootNode"
													x-node="doc">
										<span class="glyphicon glyphicon-edit"></span>
									</button>
								</li>
								<li ng-if="project.userCan.manageFolders && !item.isPublished">
									<button class="btn icon-btn" title="Publish Folder" ng-click="$event.stopPropagation();"
													x-confirm-dialog
													x-title-text="'Publish Folder'"
													x-ok-text="'Yes'"
													x-cancel-text="'No'"
													x-confirm-text="'Are you sure you want to publish the selected folder?'"
													x-confirm-items="[item.displayName]"
													x-on-ok="documentMgr.publishFolder"
													x-ok-args="doc">
										<span class="glyphicon glyphicon-ok-circle"></span>
									</button>
								</li>
								<li ng-if="project.userCan.manageFolders && item.isPublished">
									<button class="btn icon-btn" title="Unpublish Folder" ng-click="$event.stopPropagation();"
													x-confirm-dialog
													x-title-text="'Unpublish Folder'"
													x-ok-text="'Yes'"
													x-cancel-text="'No'"
													x-confirm-text="'Are you sure you want to unpublish the selected folder?'"
													x-confirm-items="[item.displayName]"
													x-on-ok="documentMgr.unpublishFolder"
													x-ok-args="doc">
										<span class="glyphicon glyphicon-ban-circle"></span>
									</button>
								</li>
								<li ng-if="project.userCan.manageFolders">
									<button class="btn icon-btn" title="Delete Folder" ng-click="$event.stopPropagation();"
													x-confirm-dialog
													x-title-text="'Delete Folder'"
													x-ok-text="'Yes'"
													x-cancel-text="'No'"
													x-confirm-text="'Are you sure you want to delete this folder? This action cannot be undone.'"
													x-confirm-items="[item.displayName]"
													x-on-ok="documentMgr.deleteDir"
													x-ok-args="doc">
										<span class="glyphicon glyphicon-trash"></span>
									</button>
								</li>
								<li>
									<button class="btn icon-btn" title="Properties" ng-click="documentMgr.infoPanel.toggle();$event.stopPropagation();">
										<span class="glyphicon glyphicon-info-sign"></span>
									</button>
								</li>
							</ul>
						</div>
						<div class="btn-group"  ng-if="item.isFile">
							<button class="btn icon-btn dropdown-toggle" type="button"
											ng-click="$event.originalEvent.dropdown = true"
											data-toggle="dropdown"
											aria-haspopup="true"
											aria-expanded="false">
								<span class="glyphicon glyphicon glyphicon-option-vertical" ></span>
							</button>
							<ul class="dropdown-menu pull-right">
								<li ng-if="item.doc.userCan.read">
									<a class="btn icon-btn" href="/api/document/{{ item.id }}/fetch" target="_self" title="Download File">
										<span class="glyphicon glyphicon-download-alt"></span></a>
								</li>
								<li ng-if="item.doc.userCan.read && item.doc.internalMime === 'application/pdf'">
									<button class="btn icon-btn"
													ng-show="item.doc.internalMime === 'application/pdf'"
													x-modal-pdf-viewer
													x-pdfobject="doc"
													title="View File">
										<span class="glyphicon glyphicon-eye-open"></span>
									</button>
								</li>
								<li ng-if="item.doc.userCan.write">
									<button class="btn icon-btn" title="Edit File"
													ng-if="item.doc.userCan.write"
													x-document-mgr-edit
													x-project="project"
													x-doc="item.doc"
													x-on-update="documentMgr.onDocumentUpdate">
										<span class="glyphicon glyphicon-edit"></span>
									</button>
								</li>
								<li ng-if="item.doc.userCan.publish && !item.isPublished">
									<button class="btn icon-btn" title="Publish File" ng-click="$event.stopPropagation();"
													x-confirm-dialog
													x-title-text="'Publish File(s)'"
													x-ok-text="'Yes'"
													x-cancel-text="'No'"
													x-confirm-text="'Are you sure you want to publish the selected file?'"
													x-confirm-items="[item.displayName]"
													x-on-ok="documentMgr.publishFile"
													x-ok-args="item.doc">
										<span class="glyphicon glyphicon-ok-circle"></span>
									</button>
								</li>
								<li ng-if="item.doc.userCan.unPublish && item.isPublished">
									<button class="btn icon-btn" title="Unpublish File" ng-click="$event.stopPropagation();"
													x-confirm-dialog
													x-title-text="'Unpublish File(s)'"
													x-ok-text="'Yes'"
													x-cancel-text="'No'"
													x-confirm-text="'Are you sure you want to unpublish the selected file?'"
													x-confirm-items="[item.displayName]"
													x-on-ok="documentMgr.unpublishFile"
													x-ok-args="item.doc">
										<span class="glyphicon glyphicon-ban-circle"></span>
									</button>
								</li>
								<li ng-if="item.doc.userCan.delete">
									<button class="btn icon-btn" title="Delete File" ng-click="$event.stopPropagation();"
													x-confirm-dialog
													x-title-text="'Delete File(s)'"
													x-ok-text="'Yes'"
													x-cancel-text="'No'"
													x-confirm-text="'Are you sure you want to delete this file? This action cannot be undone.'"
													x-confirm-items="[item.displayName]"
													x-on-ok="documentMgr.deleteFile"
													x-ok-args="item.doc">
										<span class="glyphicon glyphicon-trash"></span>
									</button>
								</li>
								<li ng-if="project.userCan.manageDocumentPermissions">
									<button class="btn icon-btn" title="Edit Permissions" ng-click="$event.stopPropagation();"
													x-role-permissions-modal
													x-context="project"
													x-object="item.doc"
													x-reload="'false'"
													x-callback="documentMgr.onPermissionsUpdate">
										<span class="glyphicon glyphicon-cog"></span></button>
									</button>
								</li>
								<li>
									<button class="btn icon-btn" title="Properties" ng-click="documentMgr.infoPanel.toggle();$event.stopPropagation();">
										<span class="glyphicon glyphicon-info-sign"></span>
									</button>
								</li>
							</ul>
						</div>
					</td>
				</tr>
				<tr ng-if="!vm.displayResults || vm.displayResults.length === 0">
					<td colspan="{{vm.colspan -1}}">No records found.</td>
				</tr>
				</tbody>
				<tfoot>
				<tr>
					<td class="pagination-container clearfix" colspan="{{vm.colspan -1}}">
						<div class="pull-left" st-pagination="" st-items-by-page="vm.pageSize" st-template="modules/core/client/views/st-template.html"></div>
						<ul class="pull-right pagination">
							<li ng-class="{active: vm.pageSize==10}">
								<a ng-click="vm.changePageSize(10)">10</a>
							</li>
							<li ng-class="{active: vm.pageSize==20}">
								<a ng-click="vm.changePageSize(20)">20</a>
							</li>
							<li ng-class="{active: vm.pageSize==50}">
								<a ng-click="vm.changePageSize(50)">50</a>
							</li>
							<li ng-class="{active: vm.pageSize==100}">
								<a ng-click="vm.changePageSize(100)">100</a>
							</li>
						</ul>
					</td>
				</tr>
				</tfoot>
			</table>



		</div>
		<div class="fb-details-panel">
			<!-- Load the File/Folder Details -->
			<div class="spinner-container" ng-show="vm.isLoading">
				<div class="spinner-new rotating"></div>
			</div>

			<!-- FILE DETAILS -->
			<div class="fb-details-content" ng-if="vm.infoPanel.data && vm.infoPanel.type === 'File'">
				<div class="title-panel">
					<div class="title-panel-info">
						<button class="btn btn-default close" type="button" ng-click="vm.infoPanel.close()">
							<span aria-hidden="true">&times;</span>
						</button>
						<h2 title="{{vm.infoPanel.data.displayName | removeExtension}}">{{vm.infoPanel.data.displayName | removeExtension }}</h2>
					</div>
					<div class="title-panel-btns">
						<a ng-if="vm.infoPanel.data.userCan.read"
						   class="btn btn-sm btn-default"
						   href="/api/document/{{ vm.infoPanel.data._id }}/fetch"
						   target="_self"
						   title="Download File"><span class="glyphicon glyphicon-download-alt"></span></a>
						<button ng-if="vm.infoPanel.data.userCan.read && vm.infoPanel.data.internalMime === 'application/pdf'"
								x-modal-pdf-viewer
								x-pdfobject="vm.infoPanel.data"
								title="View File"
								class="btn btn-sm btn-default">View</button>
						<button class="btn btn-sm btn-default" ng-if="vm.infoPanel.data.userCan.write"
								x-document-mgr-edit
								x-project="project"
								x-doc="vm.infoPanel.data"
								x-on-update="vm.onDocumentUpdate">Edit</button>
						<div class="fb-menu btn-group">
							<button class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">More</button>
							<ul class="dropdown-menu pull-right">
								<li ng-if="vm.infoPanel.data.userCan.delete">
									<a title="Delete File"
									   ng-click="$event.stopPropagation();"
									   x-confirm-dialog
									   x-title-text="'Delete File(s)'"
									   x-ok-text="'Yes'"
									   x-cancel-text="'No'"
									   x-confirm-text="'Are you sure you want to delete this file? This action cannot be undone.'"
									   x-confirm-items="[vm.infoPanel.data.displayName]"
									   x-on-ok="vm.deleteFile"
									   x-ok-args="vm.infoPanel.data"><span class="glyphicon glyphicon-trash"></span> Delete</a>
								</li>
								<li ng-if="vm.infoPanel.data.userCan.publish && !vm.infoPanel.data.isPublished">
									<a title="Publish File"
									   ng-click="$event.stopPropagation();"
									   x-confirm-dialog
									   x-title-text="'Publish File'"
									   x-ok-text="'Yes'"
									   x-cancel-text="'No'"
									   x-confirm-text="'Are you sure you want to publish the selected file?'"
									   x-confirm-items="[vm.infoPanel.data.displayName]"
									   x-on-ok="vm.publishFile"
									   x-ok-args="vm.infoPanel.data"><span class="glyphicon glyphicon-ok-circle"></span> Publish</a>
								</li>
								<li ng-if="vm.infoPanel.data.userCan.unPublish && vm.infoPanel.data.isPublished">
									<a title="Unpublish File"
									   ng-click="$event.stopPropagation();"
									   x-confirm-dialog
									   x-title-text="'Unpublish File'"
									   x-ok-text="'Yes'"
									   x-cancel-text="'No'"
									   x-confirm-text="'Are you sure you want to unpublish the selected file?'"
									   x-confirm-items="[vm.infoPanel.data.displayName]"
									   x-on-ok="vm.unpublishFile"
									   x-ok-args="vm.infoPanel.data"><span class="glyphicon glyphicon-ban-circle"></span> Unpublish</a>
								</li>
								<li>
									<a title="Edit Permissions" ng-if="project.userCan.manageDocumentPermissions"
										x-role-permissions-modal
										x-context="project"
										x-object="vm.infoPanel.data"
									    x-reload="'false'"
									    x-callback="vm.onPermissionsUpdate"><span class="glyphicon glyphicon-cog"></span> Edit Permissions</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="scroll-container">
					<section class="fb-details-section">
						<h2>File Details</h2>
						<section ng-if="vm.infoPanel.data.description">
							<h3>Description</h3>
							<div class="value">{{ vm.infoPanel.data.description }}</div>
						</section>
						<section>
							<h3>Properties</h3>
							<ul class="nv-pair">
								<li ng-if="vm.authentication.user">
									<span class="name">Status:</span>
									<span class="value">
										<span class="label label-success" ng-if="vm.infoPanel.data.isPublished">Published</span>
										<span class="label label-default" ng-if="!vm.infoPanel.data.isPublished">Not Published</span>
									</span>
								</li>
								<li>
									<span class="name">Document Date:</span>
									<span class="value">{{ vm.infoPanel.data.documentDate | date : format : timezone }}</span>
								</li>
								<li>
									<span class="name">Uploaded Date:</span>
									<span class="value">{{ vm.infoPanel.data.dateUploaded | date : format : timezone }}</span>
								</li>
								<li>
									<span class="name">Size:</span>
									<span class="value">{{ vm.infoPanel.data.internalSize | bytes:2 }}</span>
								</li>
								<li>
									<span class="name">Type:</span>
									<span class="value">{{ vm.infoPanel.data.internalExt }}</span>
								</li>
								<li ng-if="vm.infoPanel.data.documentId">
									<span class="name">Document ID:</span>
									<span class="value">{{ vm.infoPanel.data.documentId }}</span>
								</li>
								<li ng-if="vm.infoPanel.data.documentType">
									<span class="name">Document Type:</span>
									<span class="value">{{ documentTypes.display(vm.infoPanel.data.documentType) }}</span>
								</li>
								<li ng-if="vm.infoPanel.data.documentType ==='Inspection Report' && vm.infoPanel.data.inspectionReport">
									<span class="name">Inspector Initials:</span>
									<span class="value">{{ vm.infoPanel.data.inspectionReport.inspectorInitials }}</span>
								</li>
								<li ng-if="vm.infoPanel.data.documentType ==='Inspection Report' && vm.infoPanel.data.inspectionReport">
									<span class="name">Follow up:</span>
									<span class="value">{{ vm.infoPanel.data.inspectionReport.followup }}</span>
								</li>

							</ul>
						</section>

						<!-- FILE KEYWORDS -->
						<!--
						<section>
							<h3>Keywords</h3>
							<ul class="comma-separated-list">
								<li>Keyword 1</li>
								<li>Keyword 2</li>
								<li>Keyword 3</li>
								<li>Keyword 4</li>
							</ul>
						</section>
						-->
						<!-- / FILE KEYWORDS -->

					</section>
				</div>
			</div><!-- / FILE DETAILS -->

			<!-- DIRECTORY DETAILS -->
			<div class="fb-details-content" ng-if="vm.infoPanel.data && vm.infoPanel.type === 'Directory'">
				<div class="title-panel">
					<div class="title-panel-info">
						<button class="btn btn-default close" type="button" ng-click="vm.infoPanel.close()">
							<span aria-hidden="true">&times;</span>
						</button>
						<h2 title="{{vm.infoPanel.data.name}}">{{vm.infoPanel.data.name}}</h2>
					</div>
				</div>
				<div class="scroll-container">
					<section>
						<ul class="nv-pair">
							<li ng-if="vm.authentication.user">
								<span class="name">Status:</span>
								<span class="value">---</span>
							</li>
							<li>
								<span class="name">Description:</span>
								<span class="value">---</span>
							</li>
							<li>
								<span class="name">Date uploaded:</span>
								<span class="value">---</span>
							</li>
						</ul>
					</section>
				</div>
			</div><!-- / DIRECTORY DETAILS -->

			<!-- NO DETAILS -->
			<div class="fb-details-content" ng-if="vm.infoPanel.data && vm.infoPanel.type === 'Multi'">
				<div class="title-panel">
					<div class="title-panel-info">
						<button class="btn btn-default close" type="button" ng-click="vm.infoPanel.close()">
							<span aria-hidden="true">&times;</span>
						</button>
						<h2 title="{{project.name}}">{{project.name}}</h2>
					</div>
				</div>
				<div class="scroll-container">
					There are {{vm.infoPanel.data.checkedFiles}} files and {{vm.infoPanel.data.checkedDirs}} folders selected.<br>Select one file or folder to view details.
				</div>
			</div>
			<div class="fb-details-content" ng-if="!vm.infoPanel.data || vm.infoPanel.type === 'None'">
				<div class="title-panel">
					<button class="btn btn-default close" type="button" ng-click="vm.infoPanel.close()">
						<span aria-hidden="true">&times;</span>
					</button>
					<h2 title="{{project.name}}">{{project.name}}</h2>
				</div>
				<div class="scroll-container">
					Select one file or folder to view details.
				</div>
			</div><!-- / NO DETAILS -->

		</div>
	</div>

</div>
